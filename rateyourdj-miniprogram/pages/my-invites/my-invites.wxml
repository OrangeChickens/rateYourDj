<!-- pages/my-invites/my-invites.wxml -->
<view class="invites-container">
  <!-- å¤´éƒ¨ -->
  <view class="invites-header">
    <view class="quota-card">
      <text class="quota-label">å¯ç”¨é¢åº¦</text>
      <text class="quota-number">{{inviteQuota}}</text>
      <text class="quota-hint">ä¸ªé‚€è¯·ç </text>
    </view>

    <button class="generate-btn" bindtap="generateCode" disabled="{{generating || inviteQuota <= 0}}">
      {{generating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆæ–°é‚€è¯·ç '}}
    </button>

    <view class="quota-notice" wx:if="{{inviteQuota <= 0}}">
      <text class="notice-icon">ğŸ’¡</text>
      <text class="notice-text">å®Œæˆä»»åŠ¡è·å¾—æ›´å¤šé‚€è¯·ç é¢åº¦</text>
      <button class="go-tasks-btn" bindtap="goToTasks">æŸ¥çœ‹ä»»åŠ¡</button>
    </view>
  </view>

  <!-- é‚€è¯·ç åˆ—è¡¨ -->
  <view class="codes-section">
    <view class="section-title">æˆ‘çš„é‚€è¯·ç </view>

    <view wx:if="{{codes.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">è¿˜æ²¡æœ‰ç”Ÿæˆé‚€è¯·ç </text>
      <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆ</text>
    </view>

    <view wx:for="{{codes}}" wx:key="code" class="code-card {{item.status}}">
      <view class="code-header">
        <text class="code-text">{{item.code}}</text>
        <view class="code-status">
          <text wx:if="{{item.status === 'used'}}">âœ“ å·²ä½¿ç”¨</text>
          <text wx:else>å¯ç”¨</text>
        </view>
      </view>

      <view class="code-info">
        <text class="info-item">ä½¿ç”¨æ¬¡æ•°: {{item.usedCount}}/{{item.usageLimit}}</text>
        <text class="info-item">åˆ›å»ºæ—¶é—´: {{item.createdAt}}</text>
      </view>

      <view wx:if="{{item.usedBy && item.usedBy.length > 0}}" class="used-by-section">
        <text class="used-by-title">è¢«è°ä½¿ç”¨:</text>
        <view wx:for="{{item.usedBy}}" wx:for-item="user" wx:key="usedAt" class="used-by-item">
          <text class="user-nickname">{{user.nickname}}</text>
          <text class="user-time">{{user.usedAt}}</text>
        </view>
      </view>

      <view class="code-actions">
        <button class="action-btn copy" bindtap="copyCode" data-code="{{item.code}}">
          å¤åˆ¶
        </button>
        <button class="action-btn share" bindtap="shareCode" data-code="{{item.code}}">
          åˆ†äº«
        </button>
      </view>
    </view>
  </view>
</view>
