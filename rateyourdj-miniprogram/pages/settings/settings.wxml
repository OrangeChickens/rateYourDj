<!--pages/settings/settings.wxml-->
<view class="container">
  <!-- 用户信息区域 -->
  <view class="user-section">
    <view wx:if="{{isLoggedIn}}" class="user-info">
      <view class="avatar-wrapper skeleton">
        <image
          src="{{userInfo.avatar_url || '/images/default-avatar.png'}}"
          class="avatar"
          mode="aspectFill"
          lazy-load="{{true}}"
          binderror="onAvatarError"
        />
      </view>
      <view class="user-details">
        <text class="nickname">{{userInfo.nickname}}</text>
        <view class="stats">
          <text class="stat-item">{{reviewCount}} {{texts.reviewCount}}</text>
          <text class="separator">·</text>
          <text class="stat-item">{{favoriteCount}} {{texts.favoriteCount}}</text>
        </view>
        <!-- 调试：显示用户角色 -->
        <text class="role-debug" style="font-size: 24rpx; color: #999; margin-top: 10rpx;">角色: {{userInfo.role || '无'}}</text>
      </view>
    </view>

    <view wx:else class="login-prompt">
      <image src="/images/default-avatar.png" class="avatar" mode="aspectFill" />
      <button class="login-btn" bindtap="handleLogin">{{texts.login}}</button>
    </view>
  </view>

  <!-- 功能菜单（仅 full access 用户可见）-->
  <view class="menu-section" wx:if="{{hasFullAccess}}">
    <!-- 我的评论 -->
    <view class="menu-item" bindtap="goToMyReviews">
      <text class="menu-icon">REV</text>
      <text class="menu-label">{{texts.myReviews}}</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 我的收藏 -->
    <view class="menu-item" bindtap="goToMyFavorites">
      <text class="menu-icon">FAV</text>
      <text class="menu-label">{{texts.myFavorites}}</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 任务中心 -->
    <view class="menu-item" bindtap="goToTasks">
      <text class="menu-icon">TASK</text>
      <text class="menu-label">任务中心</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 我的邀请码 -->
    <view class="menu-item" bindtap="goToMyInvites">
      <text class="menu-icon">CODE</text>
      <text class="menu-label">我的邀请码</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 提交DJ资料（非管理员） -->
    <view class="menu-item" wx:if="{{!isAdmin}}" bindtap="goToSubmitDJ">
      <text class="menu-icon">DJ</text>
      <text class="menu-label">提交DJ资料</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- 管理员菜单 -->
  <view class="menu-section" wx:if="{{isAdmin}}">
    <view class="menu-item" bindtap="goToUploadDJ">
      <text class="menu-icon">ADD</text>
      <text class="menu-label">上传DJ资料</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="goToPendingDJs">
      <text class="menu-icon">REV</text>
      <text class="menu-label">待审核DJ</text>
      <text wx:if="{{pendingCount > 0}}" class="menu-badge">{{pendingCount}}</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- 设置菜单 -->
  <view class="menu-section">
    <!-- 语言设置 -->
    <view class="menu-item" bindtap="switchLanguage">
      <text class="menu-icon">LANG</text>
      <text class="menu-label">{{texts.language}}</text>
      <text class="menu-value">{{currentLanguage === 'zh-CN' ? texts.chinese : texts.english}}</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 关于 -->
    <view class="menu-item" bindtap="showAbout">
      <text class="menu-icon">INFO</text>
      <text class="menu-label">{{texts.about}}</text>
      <text class="menu-value">v1.0.0</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- 退出登录 -->
  <view wx:if="{{isLoggedIn}}" class="logout-section">
    <button class="logout-btn" bindtap="handleLogout">{{texts.logout}}</button>
  </view>
</view>
