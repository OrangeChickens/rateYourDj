<!--pages/review-create/review-create.wxml-->
<view class="container">
  <view class="page-header">
    <text class="dj-name">{{djName}}</text>
  </view>

  <scroll-view scroll-y class="form-content">
    <!-- 综合评分 -->
    <view class="rating-section">
      <view class="section-title">{{texts.rateOverall}} *</view>
      <view class="stars-input">
        <text
          wx:for="{{[1,2,3,4,5]}}"
          wx:key="index"
          class="star {{overallRating >= item ? 'active' : ''}}"
          bindtap="setRating"
          data-type="overallRating"
          data-value="{{item}}"
        >★</text>
      </view>
      <text class="rating-value">{{overallRating || '-'}}/5</text>
    </view>

    <!-- Set评分 -->
    <view class="rating-section">
      <view class="section-title">{{texts.rateSet}} *</view>
      <view class="stars-input">
        <text
          wx:for="{{[1,2,3,4,5]}}"
          wx:key="index"
          class="star {{setRating >= item ? 'active' : ''}}"
          bindtap="setRating"
          data-type="setRating"
          data-value="{{item}}"
        >★</text>
      </view>
      <text class="rating-value">{{setRating || '-'}}/5</text>
    </view>

    <!-- 表演力评分 -->
    <view class="rating-section">
      <view class="section-title">{{texts.ratePerformance}} *</view>
      <view class="stars-input">
        <text
          wx:for="{{[1,2,3,4,5]}}"
          wx:key="index"
          class="star {{performanceRating >= item ? 'active' : ''}}"
          bindtap="setRating"
          data-type="performanceRating"
          data-value="{{item}}"
        >★</text>
      </view>
      <text class="rating-value">{{performanceRating || '-'}}/5</text>
    </view>

    <!-- 性格评分 -->
    <view class="rating-section">
      <view class="section-title">{{texts.ratePersonality}} *</view>
      <view class="stars-input">
        <text
          wx:for="{{[1,2,3,4,5]}}"
          wx:key="index"
          class="star {{personalityRating >= item ? 'active' : ''}}"
          bindtap="setRating"
          data-type="personalityRating"
          data-value="{{item}}"
        >★</text>
      </view>
      <text class="rating-value">{{personalityRating || '-'}}/5</text>
    </view>

    <!-- 是否会再选 -->
    <view class="toggle-section">
      <text class="section-title">{{texts.wouldChooseAgain}}</text>
      <switch
        checked="{{wouldChooseAgain}}"
        bindchange="toggleWouldChoose"
        color="#FFD700"
      />
    </view>

    <!-- 标签选择 -->
    <view class="tags-section">
      <view class="section-title">{{texts.selectTags}}</view>

      <!-- 音乐风格标签 -->
      <view class="tag-group">
        <text class="group-title">{{texts.styleTags}}</text>
        <view class="tag-list">
          <view
            wx:for="{{presetTags}}"
            wx:if="{{item.category === 'style'}}"
            wx:key="id"
            class="tag {{item.selected ? 'selected' : ''}}"
            bindtap="toggleTag"
            data-name="{{item.name}}"
            data-index="{{index}}"
          >{{item.name}}</view>
        </view>
      </view>

      <!-- 表现力标签 -->
      <view class="tag-group">
        <text class="group-title">{{texts.performanceTags}}</text>
        <view class="tag-list">
          <view
            wx:for="{{presetTags}}"
            wx:if="{{item.category === 'performance'}}"
            wx:key="id"
            class="tag {{item.selected ? 'selected' : ''}}"
            bindtap="toggleTag"
            data-name="{{item.name}}"
            data-index="{{index}}"
          >{{item.name}}</view>
        </view>
      </view>

      <!-- 性格标签 -->
      <view class="tag-group">
        <text class="group-title">{{texts.personalityTags}}</text>
        <view class="tag-list">
          <view
            wx:for="{{presetTags}}"
            wx:if="{{item.category === 'personality'}}"
            wx:key="id"
            class="tag {{item.selected ? 'selected' : ''}}"
            bindtap="toggleTag"
            data-name="{{item.name}}"
            data-index="{{index}}"
          >{{item.name}}</view>
        </view>
      </view>

      <view class="selected-count">
        {{texts.tagsSelected}} {{selectedTags.length}}/{{maxTags}}
      </view>
    </view>

    <!-- 文字评论 -->
    <view class="comment-section">
      <view class="section-title">{{texts.writeComment}}</view>
      <textarea
        class="comment-input"
        placeholder="{{texts.commentPlaceholder}}"
        value="{{comment}}"
        bindinput="onCommentInput"
        maxlength="500"
        auto-height
      />
      <view class="char-count">{{comment.length}}/500</view>
    </view>

    <!-- 匿名选项 -->
    <view class="anonymous-section">
      <text class="section-title">{{texts.anonymous}}</text>
      <switch
        checked="{{isAnonymous}}"
        bindchange="toggleAnonymous"
        color="#FFD700"
      />
    </view>

    <!-- 底部间距 -->
    <view style="height: 200rpx;"></view>
  </scroll-view>

  <!-- 滑动提交区域 -->
  <view
    class="swipe-submit-area {{swipeProgress > 0 ? 'active' : ''}}"
    bindtouchstart="handleTouchStart"
    bindtouchmove="handleTouchMove"
    bindtouchend="handleTouchEnd"
  >
    <view class="swipe-indicator" style="transform: translateY({{-swipeProgress * 0.3}}rpx)">
      <text class="swipe-icon">↑</text>
      <text class="swipe-text">{{swipeProgress >= 100 ? '松手提交' : '向上滑动提交'}}</text>
    </view>
    <view class="swipe-progress-bar">
      <view class="swipe-progress-fill" style="width: {{swipeProgress}}%"></view>
    </view>
  </view>
</view>
