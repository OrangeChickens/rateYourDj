# å¼ºåˆ¶é‚€è¯·ç ç³»ç»Ÿå®ç°æ–‡æ¡£

## å®ç°æ¦‚è¿°

ä¸ºäº†é€šè¿‡å¾®ä¿¡å°ç¨‹åºå®¡æ ¸ï¼Œå®ç°äº†å¼ºåˆ¶é‚€è¯·ç ç³»ç»Ÿï¼Œæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
1. **éšç§æ”¿ç­–åˆè§„**ï¼šç™»å½•é¡µæ·»åŠ éšç§æ”¿ç­–åŒæ„å¤é€‰æ¡†ï¼ˆç”¨æˆ·å¿…é¡»ä¸»åŠ¨å‹¾é€‰ï¼‰
2. **åå¼ºåˆ¶ç™»å½•**ï¼šå…è®¸æœªç™»å½•ç”¨æˆ·åœ¨éªŒè¯é‚€è¯·ç åæµè§ˆå†…å®¹
3. **å†…æµ‹ä¿æŠ¤**ï¼šæ‰€æœ‰ç”¨æˆ·å¿…é¡»å…ˆéªŒè¯é‚€è¯·ç æ‰èƒ½è®¿é—®åº”ç”¨

---

## ç³»ç»Ÿæµç¨‹

### æµç¨‹å›¾

```
å¯åŠ¨å°ç¨‹åº
    â†“
Waitlist é¡µé¢ï¼ˆå¯åŠ¨é¡µï¼‰
    â”œâ”€ å·²ç™»å½•ç”¨æˆ·ï¼Ÿ â†’ ç›´æ¥è¿›å…¥é¦–é¡µï¼ˆè·³è¿‡ Waitlistï¼‰
    â””â”€ æœªç™»å½•ç”¨æˆ·ï¼Ÿ
        â†“
   è¾“å…¥é‚€è¯·ç 
        â†“
   éªŒè¯é‚€è¯·ç ï¼ˆè°ƒç”¨ /api/auth/verify-invite-codeï¼‰
        â”œâ”€ éªŒè¯æˆåŠŸ â†’ ä¿å­˜åˆ° pendingInviteCode â†’ è¿›å…¥é¦–é¡µï¼ˆæµè§ˆæ¨¡å¼ï¼‰
        â””â”€ éªŒè¯å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œç•™åœ¨ Waitlist é¡µé¢
            â†“
   é¦–é¡µæµè§ˆï¼ˆæœªç™»å½•ï¼‰
        â”œâ”€ æŸ¥çœ‹ DJ åˆ—è¡¨ âœ…
        â”œâ”€ æŸ¥çœ‹ DJ è¯¦æƒ… âœ…
        â”œâ”€ æŸ¥çœ‹è¯„ä»· âœ…
        â””â”€ äº’åŠ¨æ“ä½œï¼ˆè¯„ä»·ã€æ”¶è—ã€ç‚¹èµï¼‰âŒ â†’ æç¤ºç™»å½•
            â†“
   ç‚¹å‡»ç™»å½• â†’ è·³è½¬åˆ°ç™»å½•é¡µ
        â†“
   ç™»å½•é¡µ
        â”œâ”€ é€‰æ‹©å¤´åƒï¼ˆå¯é€‰ï¼‰
        â”œâ”€ è¾“å…¥æ˜µç§°ï¼ˆå¿…å¡«ï¼‰
        â”œâ”€ å‹¾é€‰éšç§æ”¿ç­–ï¼ˆå¿…å¡«ï¼‰âœ… å¾®ä¿¡å®¡æ ¸è¦æ±‚
        â””â”€ ç‚¹å‡»ç™»å½•
            â†“
   è°ƒç”¨ /api/auth/loginï¼ˆæºå¸¦ pendingInviteCodeï¼‰
        â”œâ”€ è·å–å¾®ä¿¡ openid
        â”œâ”€ åˆ›å»º/æ›´æ–°ç”¨æˆ·
        â”œâ”€ è‡ªåŠ¨æ¿€æ´»é‚€è¯·ç ï¼ˆå¦‚æœæœ‰ pendingInviteCodeï¼‰
        â”‚   â”œâ”€ æ›´æ–°ç”¨æˆ· access_level = 'full'
        â”‚   â”œâ”€ åˆå§‹åŒ–ç”¨æˆ·ä»»åŠ¡
        â”‚   â””â”€ æ¸…é™¤ pendingInviteCode
        â””â”€ è¿”å› JWT token
            â†“
   ç™»å½•æˆåŠŸ â†’ è¿›å…¥é¦–é¡µï¼ˆå®Œæ•´æƒé™ï¼‰
```

---

## å®ç°ç»†èŠ‚

### 1. å‰ç«¯ä¿®æ”¹

#### Waitlist é¡µé¢
**æ–‡ä»¶**ï¼š`rateyourdj-miniprogram/pages/waitlist/`

- **ç§»é™¤**ï¼šè·³è¿‡æŒ‰é’®ï¼ˆæ— æ³•ç»•è¿‡é‚€è¯·ç éªŒè¯ï¼‰
- **æ–°å¢**ï¼šé‚€è¯·ç è¾“å…¥æ¡† + éªŒè¯æŒ‰é’®
- **é€»è¾‘**ï¼š
  - `onLoad()`: å¦‚æœæ˜¯å·²ç™»å½•çš„ full access ç”¨æˆ·ï¼Œè‡ªåŠ¨è·³è½¬é¦–é¡µ
  - `handleVerifyCode()`: è°ƒç”¨ `authAPI.verifyInviteCode(code)`
  - éªŒè¯æˆåŠŸ â†’ ä¿å­˜åˆ° `wx.setStorageSync('pendingInviteCode', code)` â†’ è·³è½¬é¦–é¡µ
  - éªŒè¯å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

#### é¦–é¡µ
**æ–‡ä»¶**ï¼š`rateyourdj-miniprogram/pages/index/index.js`

- **æ–°å¢**ï¼š`onLoad()` ä¸­çš„é‚€è¯·ç æ£€æŸ¥é€»è¾‘
```javascript
onLoad() {
  const userInfo = app.globalData.userInfo || wx.getStorageSync('userInfo');

  // æƒ…å†µ1ï¼šå·²ç™»å½•ç”¨æˆ·ï¼ˆå¿…å®šæ˜¯ full accessï¼‰
  if (userInfo) {
    this.loadContent();
    return;
  }

  // æƒ…å†µ2ï¼šæœªç™»å½•ç”¨æˆ·ï¼Œæ£€æŸ¥æ˜¯å¦éªŒè¯è¿‡é‚€è¯·ç 
  const pendingInviteCode = wx.getStorageSync('pendingInviteCode');
  if (!pendingInviteCode) {
    // æœªéªŒè¯é‚€è¯·ç ï¼Œè¿”å› waitlist
    wx.reLaunch({ url: '/pages/waitlist/waitlist' });
    return;
  }

  // éªŒè¯è¿‡é‚€è¯·ç ï¼Œå…è®¸æµè§ˆ
  this.loadContent();
}
```

#### ç™»å½•é¡µ
**æ–‡ä»¶**ï¼š`rateyourdj-miniprogram/pages/login/`

**æ–°å¢**ï¼š
- éšç§æ”¿ç­–å¤é€‰æ¡†ï¼ˆ`privacyChecked` çŠ¶æ€ï¼‰
- ç”¨æˆ·æœåŠ¡åè®®é“¾æ¥ï¼š`/pages/agreement/agreement?type=user`
- éšç§æ”¿ç­–é“¾æ¥ï¼š`/pages/agreement/agreement?type=privacy`
- ç™»å½•æŒ‰é’®ç¦ç”¨æ¡ä»¶ï¼š`disabled="{{!nickname || !privacyChecked}}"`

**ä¿®æ”¹**ï¼š`handleLogin()` é€»è¾‘
```javascript
async handleLogin() {
  // éªŒè¯éšç§æ”¿ç­–å·²å‹¾é€‰
  if (!this.data.privacyChecked) {
    showToast('è¯·å…ˆåŒæ„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–');
    return;
  }

  // è·å– pendingInviteCode
  const pendingInviteCode = wx.getStorageSync('pendingInviteCode');

  // æ„å»ºç™»å½•æ•°æ®ï¼ˆæºå¸¦é‚€è¯·ç ï¼‰
  const loginData = {
    code: loginRes.code,
    userInfo: { nickName, avatarUrl },
    inviteCode: pendingInviteCode  // ğŸ« æºå¸¦é‚€è¯·ç 
  };

  // è°ƒç”¨ç™»å½• API
  const apiRes = await app.request({
    url: '/auth/login',
    method: 'POST',
    data: loginData
  });

  // ç™»å½•æˆåŠŸåæ¸…é™¤ pendingInviteCode
  if (pendingInviteCode) {
    wx.removeStorageSync('pendingInviteCode');
  }
}
```

#### åè®®é¡µé¢
**æ–°å¢æ–‡ä»¶**ï¼š`rateyourdj-miniprogram/pages/agreement/`

- `agreement.wxml`: æ˜¾ç¤ºç”¨æˆ·æœåŠ¡åè®®æˆ–éšç§æ”¿ç­–
- `agreement.js`: æ ¹æ® `type` å‚æ•°åˆ‡æ¢å†…å®¹å’Œæ ‡é¢˜
- `agreement.wxss`: NTS æ ·å¼ï¼ˆé»‘è‰²è¾¹æ¡†ã€ç²—ä½“å­—ï¼‰

å†…å®¹åŒ…å«ï¼š
- **ç”¨æˆ·æœåŠ¡åè®®**ï¼š6 ä¸ªç« èŠ‚ï¼ˆæœåŠ¡æ¡æ¬¾ã€æœåŠ¡å†…å®¹ã€ç”¨æˆ·è¡Œä¸ºã€çŸ¥è¯†äº§æƒã€å…è´£å£°æ˜ã€åè®®ä¿®æ”¹ï¼‰
- **éšç§æ”¿ç­–**ï¼š8 ä¸ªç« èŠ‚ï¼ˆä¿¡æ¯æ”¶é›†ã€ä¿¡æ¯ä½¿ç”¨ã€ä¿¡æ¯ä¿æŠ¤ã€Cookieã€ç”¨æˆ·æƒåˆ©ã€æœªæˆå¹´äººä¿æŠ¤ã€æ”¿ç­–æ›´æ–°ã€è”ç³»æ–¹å¼ï¼‰

#### API å°è£…
**æ–‡ä»¶**ï¼š`rateyourdj-miniprogram/utils/api.js`

æ–°å¢æ–¹æ³•ï¼š
```javascript
export const authAPI = {
  // éªŒè¯é‚€è¯·ç ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€ç™»å½•ï¼‰
  verifyInviteCode(code) {
    return app.request({
      url: '/auth/verify-invite-code',
      method: 'POST',
      data: { code }
    });
  }
};
```

---

### 2. åç«¯ä¿®æ”¹

#### è®¤è¯æ§åˆ¶å™¨
**æ–‡ä»¶**ï¼š`rateyourdj-backend/src/controllers/authController.js`

**æ–°å¢å‡½æ•°**ï¼š`verifyInviteCode()`
```javascript
async function verifyInviteCode(req, res, next) {
  const { code } = req.body;

  // è°ƒç”¨ InviteCode.validate(code)
  const validation = await InviteCode.validate(code);

  if (!validation.valid) {
    return res.status(400).json({
      success: false,
      message: validation.message  // "é‚€è¯·ç ä¸å­˜åœ¨" / "å·²è¿‡æœŸ" / "å·²è¾¾ä½¿ç”¨ä¸Šé™"
    });
  }

  res.json({
    success: true,
    message: 'é‚€è¯·ç æœ‰æ•ˆ'
  });
}
```

**ä¿®æ”¹å‡½æ•°**ï¼š`wechatLogin()`
```javascript
async function wechatLogin(req, res, next) {
  const { code, userInfo, inviteCode } = req.body;  // æ–°å¢ inviteCode å‚æ•°

  // è·å– openidï¼ŒæŸ¥è¯¢/åˆ›å»ºç”¨æˆ·
  let user = await User.findByOpenid(openid);
  let isNewUser = !user;

  if (!user) {
    user = await User.create({ ...userInfo, access_level: 'waitlist' });
  }

  // ğŸ« å¦‚æœæä¾›äº†é‚€è¯·ç ä¸”ç”¨æˆ·æ˜¯æ–°ç”¨æˆ·æˆ– waitlist çŠ¶æ€ï¼Œè‡ªåŠ¨æ¿€æ´»
  if (inviteCode && (isNewUser || user.access_level === 'waitlist')) {
    try {
      await InviteCode.use(inviteCode, user.id);  // æ›´æ–°ç”¨æˆ·ä¸º full access
      await UserTask.initializeForUser(user.id);   // åˆå§‹åŒ–ä»»åŠ¡
      user = await User.findById(user.id);         // é‡æ–°è·å–ç”¨æˆ·ï¼ˆaccess_level å·²æ›´æ–°ï¼‰
    } catch (error) {
      console.error('é‚€è¯·ç æ¿€æ´»å¤±è´¥:', error.message);
      // æ¿€æ´»å¤±è´¥ä¸å½±å“ç™»å½•ï¼Œç”¨æˆ·ä»ä¸º waitlist çŠ¶æ€
    }
  }

  // ç”Ÿæˆ JWT token å¹¶è¿”å›
  const token = generateToken({ userId: user.id, openid });
  res.json({
    success: true,
    data: {
      token,
      user: { id, nickname, avatar_url, access_level }  // access_level ä¸º 'full'
    }
  });
}
```

#### è·¯ç”±
**æ–‡ä»¶**ï¼š`rateyourdj-backend/src/routes/auth.js`

æ–°å¢è·¯ç”±ï¼š
```javascript
// éªŒè¯é‚€è¯·ç ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€è®¤è¯ï¼‰
router.post('/verify-invite-code', verifyInviteCode);
```

---

### 3. æ•°æ®åº“å‡†å¤‡

#### ç”Ÿæˆå®¡æ ¸å‘˜é‚€è¯·ç 
**æ–‡ä»¶**ï¼š`rateyourdj-backend/database_migrations/create_reviewer_invite_code.sql`

```sql
INSERT INTO invite_codes (
  code,
  creator_type,
  usage_limit,
  is_active,
  expires_at
) VALUES (
  'REVIEWER2026',           -- é‚€è¯·ç 
  'admin',                  -- ç®¡ç†å‘˜ç±»å‹
  999,                      -- ä½¿ç”¨æ¬¡æ•°ä¸Šé™
  TRUE,                     -- æ¿€æ´»çŠ¶æ€
  '2026-12-31 23:59:59'    -- è¿‡æœŸæ—¶é—´
);
```

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
cd rateyourdj-backend
mysql -u root -p rateyourdj < database_migrations/create_reviewer_invite_code.sql
```

**éªŒè¯**ï¼š
```bash
mysql -u root -p rateyourdj -e "SELECT * FROM invite_codes WHERE code = 'REVIEWER2026';"
```

---

## æµ‹è¯•æ¸…å•

### æœ¬åœ°æµ‹è¯•

#### 1. é‚€è¯·ç éªŒè¯æµç¨‹
- [ ] å¯åŠ¨å°ç¨‹åº â†’ è‡ªåŠ¨è¿›å…¥ Waitlist é¡µé¢
- [ ] è¾“å…¥æ— æ•ˆé‚€è¯·ç  â†’ æ˜¾ç¤º"é‚€è¯·ç ä¸å­˜åœ¨"
- [ ] è¾“å…¥æœ‰æ•ˆé‚€è¯·ç  `REVIEWER2026` â†’ æ˜¾ç¤º"éªŒè¯æˆåŠŸ" â†’ è·³è½¬é¦–é¡µ
- [ ] é¦–é¡µå¯ä»¥æµè§ˆ DJ åˆ—è¡¨ã€è¯¦æƒ…ã€è¯„ä»·
- [ ] ç‚¹å‡»"å†™è¯„ä»·"æŒ‰é’® â†’ æ˜¾ç¤ºç™»å½•æç¤º

#### 2. ç™»å½•æµç¨‹
- [ ] ç‚¹å‡»ç™»å½• â†’ è¿›å…¥ç™»å½•é¡µ
- [ ] éšç§æ”¿ç­–å¤é€‰æ¡†æœªå‹¾é€‰ â†’ ç™»å½•æŒ‰é’®ç¦ç”¨ï¼ˆç°è‰²ï¼‰
- [ ] ç‚¹å‡»ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹â†’ æ‰“å¼€åè®®é¡µé¢
- [ ] ç‚¹å‡»ã€Šéšç§æ”¿ç­–ã€‹â†’ æ‰“å¼€éšç§æ”¿ç­–é¡µé¢
- [ ] å‹¾é€‰éšç§æ”¿ç­– + è¾“å…¥æ˜µç§° â†’ ç™»å½•æŒ‰é’®å¯ç‚¹å‡»
- [ ] ç‚¹å‡»ç™»å½• â†’ æ˜¾ç¤º"ç™»å½•æˆåŠŸ" â†’ è·³è½¬é¦–é¡µ
- [ ] é¦–é¡µæ‰€æœ‰åŠŸèƒ½å¯ç”¨ï¼ˆå†™è¯„ä»·ã€æ”¶è—ã€ç‚¹èµï¼‰

#### 3. é‚€è¯·ç æ¿€æ´»
- [ ] ç™»å½•æˆåŠŸåï¼Œ`pendingInviteCode` å·²è¢«æ¸…é™¤
- [ ] ç”¨æˆ· `access_level` ä¸º `full`
- [ ] ç”¨æˆ·ä»»åŠ¡å·²åˆå§‹åŒ–ï¼ˆå¯åœ¨ä»»åŠ¡ä¸­å¿ƒæŸ¥çœ‹ï¼‰
- [ ] é‚€è¯·ç  `used_count` +1

#### 4. å·²ç™»å½•ç”¨æˆ·å†æ¬¡æ‰“å¼€
- [ ] å…³é—­å°ç¨‹åºé‡æ–°æ‰“å¼€ â†’ ç›´æ¥è¿›å…¥é¦–é¡µï¼ˆè·³è¿‡ Waitlistï¼‰
- [ ] æ‰€æœ‰åŠŸèƒ½å¯ç”¨

---

## æäº¤å¾®ä¿¡å®¡æ ¸

### å®¡æ ¸è¯´æ˜æ–‡æ¡£

åœ¨å¾®ä¿¡å°ç¨‹åºåå°æäº¤å®¡æ ¸æ—¶ï¼Œå¡«å†™ä»¥ä¸‹è¯´æ˜ï¼š

---

**åº”ç”¨åç§°**ï¼šçƒ‚uç›˜ DJ è¯„åˆ†ç¤¾åŒº

**åº”ç”¨ç±»å‹**ï¼šç¤¾äº¤ - ç¤¾åŒº/è®ºå›

**æ ¸å¿ƒåŠŸèƒ½**ï¼šDJ è¯„åˆ†ä¸è¯„ä»·åˆ†äº«å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹ DJ ä¿¡æ¯ã€å‘å¸ƒè¯„ä»·ã€ç®¡ç†æ”¶è—ã€‚

**å†…æµ‹è¯´æ˜**ï¼š
æœ¬å°ç¨‹åºå¤„äºå†…æµ‹é˜¶æ®µï¼Œéœ€è¦é‚€è¯·ç æ‰èƒ½è®¿é—®ã€‚ä¸ºæ–¹ä¾¿å®¡æ ¸ï¼Œç‰¹æä¾›å®¡æ ¸ä¸“ç”¨é‚€è¯·ç ã€‚

**å®¡æ ¸å‘˜æµ‹è¯•æ­¥éª¤**ï¼š

1. **å¯åŠ¨å°ç¨‹åº**
   - æ‰“å¼€å°ç¨‹åºåä¼šè‡ªåŠ¨è¿›å…¥é‚€è¯·ç éªŒè¯é¡µé¢

2. **è¾“å…¥é‚€è¯·ç **
   - è¯·è¾“å…¥é‚€è¯·ç ï¼š`REVIEWER2026`
   - ç‚¹å‡»"éªŒè¯å¹¶è¿›å…¥"æŒ‰é’®
   - éªŒè¯æˆåŠŸåè‡ªåŠ¨è¿›å…¥é¦–é¡µ

3. **æµè§ˆåŠŸèƒ½ï¼ˆæ— éœ€ç™»å½•ï¼‰**
   - å¯ä»¥æµè§ˆ DJ åˆ—è¡¨
   - å¯ä»¥æŸ¥çœ‹ DJ è¯¦æƒ…é¡µ
   - å¯ä»¥æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„è¯„ä»·
   - å¯ä»¥æœç´¢ DJ

4. **ç™»å½•åŠŸèƒ½æµ‹è¯•**
   - ç‚¹å‡»é¦–é¡µå³ä¸‹è§’"æˆ‘çš„"æ ‡ç­¾
   - ç‚¹å‡»"ç™»å½•"æŒ‰é’®
   - **é‡è¦**ï¼šç™»å½•é¡µåŒ…å«éšç§æ”¿ç­–åŒæ„å¤é€‰æ¡†ï¼Œå¿…é¡»ä¸»åŠ¨å‹¾é€‰æ‰èƒ½ç™»å½•
   - ç‚¹å‡»ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹å¯æŸ¥çœ‹å®Œæ•´åè®®å†…å®¹
   - å‹¾é€‰å¤é€‰æ¡†åè¾“å…¥æ˜µç§°ï¼Œç‚¹å‡»ç™»å½•
   - ä½¿ç”¨å¾®ä¿¡è´¦å·æˆæƒç™»å½•

5. **å®Œæ•´åŠŸèƒ½æµ‹è¯•ï¼ˆéœ€ç™»å½•ï¼‰**
   - å‘å¸ƒ DJ è¯„ä»·
   - æ”¶è— DJ
   - ä¸ºè¯„ä»·ç‚¹èµ
   - æŸ¥çœ‹æˆ‘çš„æ”¶è—
   - æŸ¥çœ‹æˆ‘çš„è¯„ä»·

**éšç§æ”¿ç­–åˆè§„è¯´æ˜**ï¼š
- ç™»å½•é¡µåŒ…å«éšç§æ”¿ç­–åŒæ„å¤é€‰æ¡†ï¼Œç”¨æˆ·å¿…é¡»ä¸»åŠ¨å‹¾é€‰æ‰èƒ½ç™»å½•
- æä¾›å®Œæ•´çš„ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹é¡µé¢
- éšç§æ”¿ç­–æ˜ç¡®è¯´æ˜æ”¶é›†çš„ä¿¡æ¯ç±»å‹ã€ä½¿ç”¨ç›®çš„ã€ä¿æŠ¤æªæ–½

**æ•°æ®å®‰å…¨**ï¼š
- ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨é˜¿é‡Œäº‘ OSSï¼ˆå·²å¤‡æ¡ˆï¼‰
- æ‰€æœ‰ API ä½¿ç”¨ HTTPS åŠ å¯†ä¼ è¾“
- æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ openidï¼‰ä»…åœ¨åç«¯å¤„ç†ï¼Œä¸æš´éœ²ç»™å‰ç«¯

---

### å®¡æ ¸æ³¨æ„äº‹é¡¹

1. **é‚€è¯·ç **ï¼š`REVIEWER2026`
   - æœ‰æ•ˆæœŸè‡³ 2026-12-31
   - ä½¿ç”¨æ¬¡æ•°ä¸Šé™ 999 æ¬¡
   - å®¡æ ¸å‘˜å¯ä»¥å¤šæ¬¡ä½¿ç”¨

2. **éšç§æ”¿ç­–åˆè§„**ï¼š
   - âœ… ç™»å½•å‰å¿…é¡»ä¸»åŠ¨å‹¾é€‰å¤é€‰æ¡†
   - âœ… æä¾›å®Œæ•´åè®®å†…å®¹ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹ï¼‰
   - âœ… æ˜ç¡®è¯´æ˜æ”¶é›†ä¿¡æ¯ç±»å‹å’Œç”¨é€”

3. **åå¼ºåˆ¶ç™»å½•**ï¼š
   - âœ… å…è®¸éªŒè¯é‚€è¯·ç åæµè§ˆå†…å®¹ï¼ˆæ— éœ€ç™»å½•ï¼‰
   - âœ… ä»…äº’åŠ¨åŠŸèƒ½ï¼ˆè¯„ä»·ã€æ”¶è—ã€ç‚¹èµï¼‰éœ€è¦ç™»å½•

4. **å†…æµ‹ä¿æŠ¤**ï¼š
   - âœ… æ‰€æœ‰ç”¨æˆ·å¿…é¡»éªŒè¯é‚€è¯·ç æ‰èƒ½è®¿é—®
   - âœ… æ— é‚€è¯·ç æ— æ³•è·³è¿‡éªŒè¯é¡µé¢

---

## æŠ€æœ¯ç»†èŠ‚

### è®¿é—®çº§åˆ«è¯´æ˜

ç³»ç»Ÿåªæœ‰ä¸¤ç§è®¿é—®çº§åˆ«ï¼š

1. **æœªç™»å½• + å·²éªŒè¯é‚€è¯·ç **
   - å¯ä»¥æµè§ˆå†…å®¹ï¼ˆDJ åˆ—è¡¨ã€è¯¦æƒ…ã€è¯„ä»·ï¼‰
   - æ— æ³•è¿›è¡Œäº’åŠ¨ï¼ˆå†™è¯„ä»·ã€æ”¶è—ã€ç‚¹èµï¼‰
   - `pendingInviteCode` å­˜å‚¨åœ¨æœ¬åœ°
   - `globalData.userInfo` ä¸ºç©º

2. **å·²ç™»å½• (Full Access)**
   - æ‰€æœ‰åŠŸèƒ½å¯ç”¨
   - `access_level = 'full'`ï¼ˆé‚€è¯·ç å·²æ¿€æ´»ï¼‰
   - `globalData.userInfo` æœ‰å€¼
   - `pendingInviteCode` å·²æ¸…é™¤

**é‡è¦**ï¼šä¸å­˜åœ¨"å·²ç™»å½•ä½†ä»æ˜¯ waitlist çŠ¶æ€"çš„ç”¨æˆ·ï¼Œå› ä¸ºï¼š
- ç™»å½•æ—¶ä¼šè‡ªåŠ¨æ¿€æ´» `pendingInviteCode`
- æ¿€æ´»æˆåŠŸå `access_level` æ›´æ–°ä¸º `full`
- å¦‚æœæ¿€æ´»å¤±è´¥ï¼Œç”¨æˆ·ä»ä¸º `waitlist`ï¼Œä½†ä¼šè¢«é‡å®šå‘å› Waitlist é¡µé¢

### å®‰å…¨æœºåˆ¶

1. **é‚€è¯·ç éªŒè¯**ï¼š
   - å‰ç«¯éªŒè¯ï¼ˆ`/auth/verify-invite-code`ï¼‰ï¼šä»…æ£€æŸ¥æœ‰æ•ˆæ€§ï¼Œä¸åˆ›å»ºå…³è”
   - åç«¯æ¿€æ´»ï¼ˆ`/auth/login` æºå¸¦ `inviteCode`ï¼‰ï¼šåœ¨äº‹åŠ¡ä¸­æ›´æ–°ç”¨æˆ·çŠ¶æ€

2. **é˜²æ­¢ç»•è¿‡**ï¼š
   - é¦–é¡µ `onLoad()` å¿…é¡»æ£€æŸ¥ `pendingInviteCode`
   - æœªéªŒè¯é‚€è¯·ç ä¼šè¢«å¼ºåˆ¶é‡å®šå‘åˆ° Waitlist
   - æ‰€æœ‰äº¤äº’æ€§æ“ä½œéƒ½éœ€è¦ç™»å½•ï¼ˆJWT token éªŒè¯ï¼‰

3. **é‚€è¯·ç ä½¿ç”¨é™åˆ¶**ï¼š
   - `used_count >= usage_limit` â†’ "å·²è¾¾ä½¿ç”¨ä¸Šé™"
   - `expires_at < NOW()` â†’ "é‚€è¯·ç å·²è¿‡æœŸ"
   - `is_active = FALSE` â†’ "é‚€è¯·ç å·²ç¦ç”¨"

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šç™»å½•åä»è¢«é‡å®šå‘åˆ° Waitlist
**åŸå› **ï¼šé‚€è¯·ç æ¿€æ´»å¤±è´¥
**æ’æŸ¥**ï¼š
```bash
# æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
mysql> SELECT id, nickname, access_level, invite_code_used FROM users WHERE id = <user_id>;

# æ£€æŸ¥é‚€è¯·ç çŠ¶æ€
mysql> SELECT * FROM invite_codes WHERE code = 'REVIEWER2026';
```
**è§£å†³**ï¼š
- ç¡®ä¿é‚€è¯·ç  `is_active = TRUE`
- ç¡®ä¿ `used_count < usage_limit`
- æ£€æŸ¥åç«¯æ—¥å¿—ä¸­çš„æ¿€æ´»é”™è¯¯

### é—®é¢˜ 2ï¼šéšç§æ”¿ç­–å¤é€‰æ¡†å‹¾é€‰åç™»å½•æŒ‰é’®ä»ç¦ç”¨
**åŸå› **ï¼šæ˜µç§°æœªè¾“å…¥
**è§£å†³**ï¼šç¡®ä¿ `nickname` éç©º

### é—®é¢˜ 3ï¼šå·²ç™»å½•ç”¨æˆ·æ‰“å¼€å°ç¨‹åºä»è¿›å…¥ Waitlist
**åŸå› **ï¼š`userInfo` æœªæŒä¹…åŒ–åˆ° storage
**æ’æŸ¥**ï¼š
```javascript
console.log('Token:', wx.getStorageSync('token'));
console.log('UserInfo:', wx.getStorageSync('userInfo'));
```
**è§£å†³**ï¼šç™»å½•æˆåŠŸåç¡®ä¿è°ƒç”¨ï¼š
```javascript
wx.setStorageSync('token', token);
wx.setStorageSync('userInfo', userInfo);
```

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
rateyourdj-miniprogram/pages/agreement/
â”œâ”€â”€ agreement.js          # åè®®é¡µé¢é€»è¾‘
â”œâ”€â”€ agreement.wxml        # åè®®é¡µé¢å¸ƒå±€
â””â”€â”€ agreement.wxss        # åè®®é¡µé¢æ ·å¼

rateyourdj-backend/database_migrations/
â””â”€â”€ create_reviewer_invite_code.sql  # å®¡æ ¸å‘˜é‚€è¯·ç ç”Ÿæˆè„šæœ¬
```

### ä¿®æ”¹æ–‡ä»¶

**å‰ç«¯**ï¼š
```
rateyourdj-miniprogram/
â”œâ”€â”€ app.json                      # æ³¨å†Œ agreement é¡µé¢
â”œâ”€â”€ pages/waitlist/
â”‚   â”œâ”€â”€ waitlist.wxml            # ç§»é™¤è·³è¿‡æŒ‰é’®ï¼Œæ·»åŠ é‚€è¯·ç è¾“å…¥
â”‚   â”œâ”€â”€ waitlist.js              # ç®€åŒ–é€»è¾‘ï¼ŒéªŒè¯é‚€è¯·ç 
â”‚   â””â”€â”€ waitlist.wxss            # NTS æ ·å¼æ›´æ–°
â”œâ”€â”€ pages/index/index.js         # æ·»åŠ  pendingInviteCode æ£€æŸ¥
â”œâ”€â”€ pages/login/
â”‚   â”œâ”€â”€ login.wxml               # æ·»åŠ éšç§æ”¿ç­–å¤é€‰æ¡†
â”‚   â”œâ”€â”€ login.js                 # æ·»åŠ éšç§éªŒè¯ + é‚€è¯·ç æ¿€æ´»
â”‚   â””â”€â”€ login.wxss               # éšç§åŒºåŸŸæ ·å¼
â””â”€â”€ utils/api.js                 # æ·»åŠ  authAPI.verifyInviteCode()
```

**åç«¯**ï¼š
```
rateyourdj-backend/src/
â”œâ”€â”€ controllers/authController.js  # æ·»åŠ  verifyInviteCode() + ä¿®æ”¹ wechatLogin()
â””â”€â”€ routes/auth.js                # æ·»åŠ  /verify-invite-code è·¯ç”±
```

---

## æ€»ç»“

### å®ç°äº®ç‚¹
1. âœ… **éšç§åˆè§„**ï¼šç™»å½•å‰å¿…é¡»ä¸»åŠ¨å‹¾é€‰éšç§æ”¿ç­–å¤é€‰æ¡†
2. âœ… **åå¼ºåˆ¶ç™»å½•**ï¼šå…è®¸éªŒè¯é‚€è¯·ç åæµè§ˆå†…å®¹
3. âœ… **å†…æµ‹ä¿æŠ¤**ï¼šæ‰€æœ‰ç”¨æˆ·å¿…é¡»éªŒè¯é‚€è¯·ç 
4. âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šé‚€è¯·ç éªŒè¯ â†’ æµè§ˆ â†’ ç™»å½•ï¼ˆæ¸è¿›å¼å¼•å¯¼ï¼‰
5. âœ… **å®‰å…¨æ€§**ï¼šäº‹åŠ¡ä¿æŠ¤é‚€è¯·ç æ¿€æ´»æµç¨‹

### å¾®ä¿¡å®¡æ ¸è¦ç‚¹
1. éšç§æ”¿ç­–åŒæ„æœºåˆ¶ç¬¦åˆã€Šå¾®ä¿¡å°ç¨‹åºå¹³å°è¿è¥è§„èŒƒã€‹
2. ä¸å¼ºåˆ¶ç”¨æˆ·ç™»å½•å³å¯æµè§ˆå†…å®¹
3. å†…æµ‹é˜¶æ®µä½¿ç”¨é‚€è¯·ç æ§åˆ¶è®¿é—®ï¼ˆåˆè§„ï¼‰
4. æä¾›å®Œæ•´çš„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–æ–‡æ¡£

### ä¸Šçº¿åç»´æŠ¤
- å®šæœŸæ£€æŸ¥ `REVIEWER2026` é‚€è¯·ç çŠ¶æ€
- ç›‘æ§é‚€è¯·ç æ¿€æ´»æˆåŠŸç‡ï¼ˆåç«¯æ—¥å¿—ï¼‰
- æ ¹æ®ç”¨æˆ·åé¦ˆä¼˜åŒ–æµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-09
**ä½œè€…**: Claude Code
