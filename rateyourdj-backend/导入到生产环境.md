# 导入DJ到生产数据库

## 📋 Step 1: 配置生产数据库连接

编辑 `.env.production` 文件，填入你的生产数据库信息：

```bash
# Production Database Configuration
DB_HOST=your-production-db-host        # 例如：rm-xxxxx.mysql.rds.aliyuncs.com
DB_PORT=3306
DB_USER=your-production-db-user        # 例如：rateyourdj
DB_PASSWORD=your-production-db-password
DB_NAME=rateyourdj
```

### 常见的生产数据库类型：

#### 1. 阿里云RDS
```bash
DB_HOST=rm-xxxxx.mysql.rds.aliyuncs.com
DB_PORT=3306
DB_USER=rateyourdj
DB_PASSWORD=your-password
DB_NAME=rateyourdj
```

#### 2. 腾讯云MySQL
```bash
DB_HOST=cdb-xxxxx.tencentcdb.com
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your-password
DB_NAME=rateyourdj
```

#### 3. AWS RDS
```bash
DB_HOST=xxxxx.xxxxx.rds.amazonaws.com
DB_PORT=3306
DB_USER=admin
DB_PASSWORD=your-password
DB_NAME=rateyourdj
```

---

## 🚀 Step 2: 准备CSV文件

确保你的DJ数据已经整理好在CSV文件中，例如 `dj_import_template.csv`

---

## 💻 Step 3: 执行导入

### 方式1：基础版（适合已有图片URL）

```bash
node scripts/import-djs.js dj_import_template.csv prod
```

### 方式2：高级版（自动上传照片到OSS）

```bash
node scripts/import-djs-with-photos.js dj_import_template.csv prod
```

**注意：** 命令最后的 `prod` 参数表示使用生产环境配置

---

## ✅ Step 4: 验证导入结果

### 查看导入统计

脚本会显示：
```
📊 导入统计：
   ✅ 成功: 4 条
   ⚠️  跳过: 0 条
   ❌ 失败: 0 条
   📝 总计: 4 条
```

### 登录生产数据库验证

```bash
# 连接到生产数据库
mysql -h your-production-db-host -u your-user -p rateyourdj

# 查看导入的DJ
SELECT id, name, city, created_at
FROM djs
ORDER BY created_at DESC
LIMIT 10;

# 查看各城市DJ数量
SELECT city, COUNT(*) as count
FROM djs
GROUP BY city
ORDER BY count DESC;
```

---

## ⚠️  重要提示

### 1. 测试优先
建议先在开发环境测试，确认CSV格式正确后再导入生产环境：

```bash
# 先在开发环境测试
node scripts/import-djs.js dj_import_template.csv

# 确认无误后，再导入生产环境
node scripts/import-djs.js dj_import_template.csv prod
```

### 2. 备份数据库
导入前建议先备份生产数据库：

```bash
# 导出备份
mysqldump -h your-host -u your-user -p rateyourdj > backup_before_import.sql
```

### 3. 分批导入
如果有大量DJ数据，建议分批导入：

```bash
# 每次导入50-100条
node scripts/import-djs.js batch1.csv prod
node scripts/import-djs.js batch2.csv prod
node scripts/import-djs.js batch3.csv prod
```

### 4. 不会重复导入
脚本会自动检测同名同城市的DJ，已存在的会跳过，不会重复导入。

---

## 🔍 常见问题

### Q1: 连接生产数据库失败
**检查项：**
- 数据库地址、端口是否正确
- 用户名、密码是否正确
- 生产数据库是否允许你的IP访问（白名单）
- 防火墙是否开放3306端口

### Q2: 导入后小程序看不到DJ
**原因：**
- 前端连接的可能还是开发环境后端
- 需要确保前端 `apiBaseUrl` 指向生产后端

### Q3: 照片显示不出来
**检查：**
- photo_url是否是HTTPS链接
- 图片链接是否可以在浏览器中打开
- 建议使用高级版脚本自动上传到OSS

### Q4: 如何回滚导入
如果导入有误，可以删除本次导入的DJ：

```sql
-- 查看最近导入的DJ（根据ID或时间）
SELECT * FROM djs WHERE created_at > '2026-02-07 14:00:00';

-- 确认无误后删除
DELETE FROM djs WHERE created_at > '2026-02-07 14:00:00';
```

---

## 📞 需要帮助？

如遇到问题，请检查：
1. `.env.production` 配置是否正确
2. 数据库是否可以正常连接
3. CSV文件格式是否正确
4. 查看脚本输出的错误信息

祝导入顺利！🎉
