# åŒæ­¥åˆ° RDS - å¿«é€ŸæŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

**å¾…åŒæ­¥çš„è¿ç§»æ–‡ä»¶**ï¼š
```
001_add_comments.sql  â† è¯„è®ºç³»ç»Ÿï¼ˆReddit é£æ ¼ï¼‰
```

**å†…å®¹**ï¼š
- âœ… `review_comments` è¡¨ï¼ˆåµŒå¥—è¯„è®ºï¼Œæœ€å¤š 3 å±‚ï¼‰
- âœ… `comment_votes` è¡¨ï¼ˆupvote/downvote æŠ•ç¥¨ï¼‰

---

## ğŸš€ åŒæ­¥æ­¥éª¤

### 1. æ·»åŠ ç™½åå•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

æŸ¥çœ‹æœ¬æœºå…¬ç½‘ IPï¼š
```bash
curl ifconfig.me
```

åœ¨é˜¿é‡Œäº‘ RDS æ§åˆ¶å°ï¼š
```
æ•°æ®åº“åˆ—è¡¨ â†’ é€‰æ‹©å®ä¾‹ â†’ æ•°æ®å®‰å…¨æ€§ â†’ ç™½åå•è®¾ç½® â†’ æ·»åŠ ç™½åå•åˆ†ç»„
```

è¾“å…¥ä½ çš„ IPï¼ˆä¾‹å¦‚ï¼š`123.45.67.89/32`ï¼‰

### 2. æ£€æŸ¥è¿æ¥

```bash
cd rateyourdj-backend
./scripts/check-rds-status.sh
```

æˆåŠŸä¼šæ˜¾ç¤ºï¼š
```
âœ… è¿æ¥æˆåŠŸ
âœ… æ•°æ®åº“å­˜åœ¨
ğŸ“Š æ•°æ®è¡¨ï¼šæ€»æ•° XX
ğŸ“ å·²åº”ç”¨çš„è¿ç§»ï¼šæ€»æ•° X
ğŸ“¦ å¾…åº”ç”¨çš„è¿ç§»ï¼š
  â†’ 001_add_comments.sql
```

### 3. æ‰§è¡ŒåŒæ­¥

```bash
./scripts/sync-to-rds.sh
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸ”„ åº”ç”¨ 001_add_comments.sql...
âœ… å·²åº”ç”¨ 001_add_comments.sql

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ RDS åŒæ­¥å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å·²åº”ç”¨çš„è¿ç§»æ€»æ•°: 2
æ•°æ®è¡¨æ€»æ•°: 13
```

---

## âœ… éªŒè¯åŒæ­¥ç»“æœ

### æ£€æŸ¥æ–°è¡¨æ˜¯å¦åˆ›å»º

```bash
mysql -h rm-uf6gsfs4nfhz9rwe3mo.mysql.rds.aliyuncs.com \
      -u rateyourdj -p rateyourdj \
      -e "SHOW TABLES LIKE '%comment%'"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
+----------------------------+
| Tables_in_rateyourdj       |
+----------------------------+
| comment_votes              |
| review_comments            |
+----------------------------+
```

### æ£€æŸ¥è¿ç§»è®°å½•

```bash
mysql -h rm-uf6gsfs4nfhz9rwe3mo.mysql.rds.aliyuncs.com \
      -u rateyourdj -p rateyourdj \
      -e "SELECT * FROM schema_migrations ORDER BY applied_at DESC"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
+----+---------------------------------------+---------------------+
| id | migration_name                        | applied_at          |
+----+---------------------------------------+---------------------+
|  2 | 001_add_comments.sql                  | 2026-02-08 XX:XX:XX |
|  1 | 001_add_waitlist_and_tasks_fixed.sql  | 2026-02-XX XX:XX:XX |
+----+---------------------------------------+---------------------+
```

---

## ğŸ”’ å®‰å…¨è¯´æ˜

### å¹‚ç­‰æ€§ä¿è¯

âœ… è„šæœ¬å¯ä»¥å®‰å…¨åœ°å¤šæ¬¡è¿è¡Œ
- å·²åº”ç”¨çš„è¿ç§»ä¼šè¢«è‡ªåŠ¨è·³è¿‡
- `schema_migrations` è¡¨è¿½è¸ªå·²åº”ç”¨çš„è¿ç§»
- æŒ‰æ–‡ä»¶ååŒ¹é…ï¼Œä¸æ˜¯æŒ‰ç¼–å·

### ä¸ä¼šå†²çª

- RDS ä¿ç•™æ—§è®°å½•ï¼š`001_add_waitlist_and_tasks_fixed.sql`
- æ–°è¿ç§»ç‹¬ç«‹ï¼š`001_add_comments.sql` æ˜¯ä¸åŒçš„æ–‡ä»¶å
- æ–‡ä»¶åå”¯ä¸€æ€§ç¡®ä¿ä¸ä¼šé‡å¤åº”ç”¨

---

## ğŸ“ æ·»åŠ æ–°è¿ç§»

ä»¥åéœ€è¦æ–°çš„è¿ç§»æ—¶ï¼š

```bash
cd rateyourdj-backend/migrations

# åˆ›å»ºæ–°è¿ç§»ï¼ˆç¼–å·é€’å¢ï¼‰
nano 002_your_migration_name.sql

# å†™å…¥ SQL
# ...

# æäº¤åˆ° Git
git add migrations/002_your_migration_name.sql
git commit -m "feat: add XXX migration"

# åŒæ­¥åˆ° RDS
./scripts/sync-to-rds.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æŸ¥æ‰¾æ‰€æœ‰ `001_*.sql`, `002_*.sql`, `003_*.sql` ç­‰æ–‡ä»¶
2. æŒ‰æ•°å­—æ’åº
3. æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶æ˜¯å¦å·²åº”ç”¨
4. åº”ç”¨æœªæ‰§è¡Œçš„è¿ç§»

---

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚æœåŒæ­¥ä¸­æ–­æ€ä¹ˆåŠï¼Ÿ

A: é‡æ–°è¿è¡Œ `./scripts/sync-to-rds.sh` å³å¯
   - å·²æˆåŠŸçš„è¿ç§»ä¼šè¢«è·³è¿‡
   - æœªå®Œæˆçš„è¿ç§»ä¼šç»§ç»­æ‰§è¡Œ

### Q: å¦‚ä½•å›æ»šè¿ç§»ï¼Ÿ

A: æ‰‹åŠ¨æ‰§è¡Œ rollback SQL æˆ–æ¢å¤ RDS å¿«ç…§
   ```bash
   mysql -h ... -u ... -p ... < migrations/rollback_XXX.sql
   ```

### Q: è¿ç§»å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

A: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
   - æ£€æŸ¥ SQL è¯­æ³•
   - æ£€æŸ¥å¤–é”®çº¦æŸ
   - æ£€æŸ¥è¡¨æ˜¯å¦å·²å­˜åœ¨

   ä¿®å¤åé‡æ–°è¿è¡ŒåŒæ­¥è„šæœ¬

---

## ğŸ¯ é…ç½®ä¿¡æ¯

**RDS è¿æ¥**ï¼š`rm-uf6gsfs4nfhz9rwe3mo.mysql.rds.aliyuncs.com`
**æ•°æ®åº“**ï¼š`rateyourdj`
**ç”¨æˆ·**ï¼š`rateyourdj`
**é…ç½®æ–‡ä»¶**ï¼š`.env.production`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `scripts/é˜¿é‡Œäº‘RDSé…ç½®.md` - é˜¿é‡Œäº‘ RDS è¯¦ç»†é…ç½®æŒ‡å—
- `scripts/README-SYNC.md` - RDS åŒæ­¥è¯¦ç»†æ–‡æ¡£
- `scripts/RDS-SYNC.md` - English documentation
